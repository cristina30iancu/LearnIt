<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="shortcut icon" type="image/png" href="../images/icon/fav.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.5)), url("../images/extra/wall_quiz.jpeg");
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            justify-content: center;
        }

        h1 {
            color: #d96895;
            margin-bottom: 20px;
            font-size: 50px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(60, 196, 214, 0.6), -2px -2px 4px rgba(253, 1, 131, 0.6);
        }

        .button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        button {
            background-color: rgba(164, 232, 225, 0.5);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover,
        button:focus {
            background-color: rgba(133, 239, 229, 0.7);
            transform: translateY(-2px);
        }
    </style>
</head>

<body>
    <h1>Alegeți un quiz</h1>
    <div class="button-container">
        <button onclick="loadQuiz('662a49e20c692e552d393b66', 'Structuri de Date în Limbajul C')">Începe quiz-ul la
            Structuri de Date în Limbajul C</button>

        <button onclick="loadQuiz('662a4a640c692e552d393b68', 'Programare C++')">Începe quiz-ul la C++</button>

        <button onclick="loadQuiz('662a4d3b0c692e552d393b6d', 'JAVA')">Începe quiz-ul la Java</button>
        <button onclick="loadQuiz('662a51df0c692e552d393b75', 'JavaScript')">Începe quiz-ul la JavaScript</button>
        <button onclick="loadQuiz('662a51df0c692e552d393b75', 'Baze de Date')">Începe quiz-ul la Baze de Date</button>
        <button onclick="loadQuiz('662a4e7e0c692e552d393b71', 'Python')">Începe quiz-ul la Python</button>
        <button onclick="loadQuiz('662a4fba0c692e552d393b73', 'Algoritmi')">Începe quiz-ul la Algoritmi</button>
        <button onclick="loadQuiz('662a610f0c692e552d393b77', 'Cunoștințe Esențiale')">Începe quiz-ul la Cunoștințe
            Esențiale</button>

        <button onclick="navigateToCompletedTests()">Teste completate</button>
    </div>

    <!-- Container afișare quiz-ului -->
    <div id="quiz-container"></div>
    <button id="submit-quiz-button" style="display: none;" onclick="submitQuiz()">Trimite test</button>

    <script>
        let currentQuizId = '';

        function loadQuiz(id, subject) {
            currentQuizId = id;
            const url = `http://localhost:3000/api/quiz/${id}/${encodeURIComponent(subject)}`;
            console.log("URL cerut:", url);

            fetch(url)
                .then(response => {
                    if (!response.ok) throw new Error('Failed to load the quiz');
                    return response.json();
                })
                .then(data => {
                    if (data.questions && data.questions.length > 0) {
                        displayQuiz(data);
                        document.getElementById('submit-quiz-button').style.display = 'block';
                    } else {
                        console.log('Nu s-au găsit întrebări pentru acest subiect.');
                        document.getElementById('submit-quiz-button').style.display = 'none';
                    }
                })
                .catch(error => console.error('Error loading the quiz:', error));
        }

        function displayQuiz(quiz) {
            console.log("Quiz primit pentru afișare:", quiz);
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';

            if (!quiz.questions) {
                console.error('Nu există întrebări în obiectul quiz:', quiz);
                container.innerHTML = 'Nu există întrebări disponibile.';
                return;
            }

            const questions = quiz.questions;
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.innerHTML = `<h3>${index + 1}. ${q.question}</h3>` +
                    q.options.map((option, i) => `<label><input type="radio" name="question${index}" value="${option}"> ${option}</label>`).join('');
                container.appendChild(questionDiv);
            });
        }

        function submitQuiz() {
            const container = document.getElementById('quiz-container');
            const questions = container.querySelectorAll('div');
            const answers = [];
            questions.forEach((question, index) => {
                const selectedOption = question.querySelector('input[type="radio"]:checked');
                if (selectedOption) {
                    answers.push({ questionIndex: index, answer: selectedOption.value });
                }
            });

            const payload = {
                quizId: currentQuizId,
                answers: answers
            };

            fetch('http://localhost:3000/api/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization':localStorage.getItem('userToken') // assuming you have a token for authentication
                },
                body: JSON.stringify(payload)
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Scorul obținut:', data);
                    alert(`Ai obținut un scor de ${data.score}`);
                })
                .catch(error => console.error('Error submitting the quiz:', error));
        }

        function navigateToCompletedTests() {
            // Logica pentru navigarea la testele completate
        }
    </script>

</body>

</html>
